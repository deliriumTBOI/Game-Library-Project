# Расширенные Сценарии Использования для Игровой Библиотеки

## 1. Авторизация пользователя (User Login to Application)

**Акторы:** Пользователь (User)  
**Описание:** Пользователь входит в систему, чтобы получить доступ к персонализированным функциям.

### Основной поток событий:
1. **Начало:** Пользователь открывает веб-приложение.  
2. **Client UI:** Отображает главную страницу.  
3. **Client UI:** Пользователь нажимает кнопку **"Войти"** (Log In).  
4. **Client UI:** Отображается форма входа с полями для email и пароля.  
5. **User:** Вводит email и пароль.  
6. **User:** Нажимает кнопку **"Войти"**.  
7. **Client UI:** Отправляет `POST`-запрос на `/api/auth/login` с email и паролем в **Auth Controller**.  
8. **Auth Controller:** Вызывает `authenticate(email, password)` в **User Service**.  
9. **User Service:** Выполняет запрос к **Database** для получения данных пользователя.  
10. **User Service:** Верифицирует хеш пароля.  
11. **Auth Controller:** Получает результат аутентификации.  
12. Если данные корректны:
    - **Auth Controller:** Генерирует **JWT/Session Token**.  
    - Отправляет ответ `200 OK` с токеном и данными пользователя.  
    - **Client UI:** Сохраняет токен и обновляет интерфейс (показывает имя пользователя, кнопки “Мои игры”, “Выйти”).  

**Конец.**

### Альтернативный поток: Неправильные учетные данные
- **Auth Controller:** Возвращает `401 Unauthorized` с сообщением об ошибке.  
- **Client UI:** Отображает сообщение: *"Неправильный email или пароль."*  
- **User:** Может повторить попытку или выбрать “Забыли пароль?” / “Регистрация”.

---

## 2. Просмотр информации об игре (View Game Information)

**Акторы:** Пользователь (User)  
**Описание:** Пользователь просматривает подробную информацию о конкретной игре.

### Основной поток событий:
1. **User:** Просматривает каталог игр.  
2. **Client UI:** Отправляет `GET /api/games` в **Game Controller**.  
3. **Game Controller → Game Service → Database:** Извлекает список игр.  
4. **Client UI:** Отображает каталог.  
5. **User:** Выбирает игру.  
6. **Client UI:** Отправляет `GET /api/games/{gameId}`.  
7. **Game Controller:** Получает данные игры и вызывает **Review Service**.  
8. **Review Service → Database:** Извлекает отзывы об игре.  
9. **Client UI:** Рендерит страницу игры с отзывами и данными.

**Конец.**

---

## 3. Оставить или отредактировать отзыв (Leave/Edit Review)

**Акторы:** Авторизованный пользователь (Authenticated User)  
**Предусловие:** Пользователь должен быть авторизован.  
**Описание:** Пользователь оставляет новый отзыв или редактирует существующий.

### Основной поток (новый отзыв):
1. **User:** Находится на странице игры.  
2. **Client UI:** Проверяет наличие отзыва от текущего пользователя.  
3. Если отзыва нет — отображает кнопку **"Оставить отзыв"**.  
4. **User:** Заполняет форму с рейтингом и комментарием.  
5. **Client UI:** Отправляет `POST /api/reviews` с данными отзыва.  
6. **Review Service:** Валидирует и сохраняет отзыв в **Database**.  
7. **Client UI:** Получает `201 Created` и обновляет раздел отзывов.  

**Конец.**

### Альтернативный поток (редактирование отзыва):
1. **User:** Нажимает **"Редактировать"** рядом со своим отзывом.  
2. **Client UI:** Отображает форму с текущими данными.  
3. **User:** Вносит изменения и сохраняет.  
4. **Client UI:** Отправляет `PUT /api/reviews/{reviewId}`.  
5. **Review Service:** Обновляет данные в **Database**.  
6. **Client UI:** Получает `200 OK` и обновляет страницу.  

**Конец.**

### Альтернативный поток: Невалидные данные
- **Review Service:** Возвращает `400 Bad Request` с ошибками.  
- **Client UI:** Отображает подсказки:  
  - “Комментарий не может быть пустым.”  
  - “Пожалуйста, выберите рейтинг.”  

---

## 4. Добавление игры в список желаемого (Add Game to Wishlist)

**Акторы:** Авторизованный пользователь  
**Предусловие:** Пользователь должен быть авторизован.  
**Описание:** Пользователь добавляет игру в список желаемого.

### Основной поток:
1. **User:** На странице игры нажимает **"Добавить в список желаемого"**.  
2. **Client UI:** Отправляет `POST /api/users/{userId}/wishlist` с `gameId`.  
3. **User Service:** Проверяет существование пользователя и игры.  
4. **Database:** Сохраняет запись `WishlistEntry`.  
5. **Client UI:** Получает `201 Created`, отображает “Игра добавлена в список желаемого!”.  

**Конец.**

### Альтернативный поток: Игра уже в списке
- **User Service:** Обнаруживает дубликат, возвращает `409 Conflict`.  
- **Client UI:** Показывает сообщение: “Эта игра уже в вашем списке желаемого!”.

---

## 5. Просмотр списка желаемого (View Wishlist)

**Акторы:** Авторизованный пользователь  
**Предусловие:** Пользователь авторизован.  
**Описание:** Пользователь просматривает свой список желаемых игр.

### Основной поток:
1. **User:** Нажимает на **"Список желаемого"** в меню.  
2. **Client UI:** Отправляет `GET /api/users/{userId}/wishlist`.  
3. **User Service → Database:** Извлекает список `WishlistEntry`.  
4. **User Service:** Получает данные игр по каждому `gameId`.  
5. **Client UI:** Получает `200 OK` с `List<Game>` и отображает страницу списка желаемого.  

**Конец.**

### Альтернативный поток: Пустой список
- **User Service:** Возвращает пустой список.  
- **Client UI:** Показывает сообщение: *“Ваш список желаемого пуст. Добавьте игры, которые хотите приобрести!”*

---

## 6. Регистрация нового пользователя (User Registration)

**Акторы:** Новый пользователь  
**Описание:** Новый пользователь регистрирует учетную запись.

### Основной поток:
1. **User:** Открывает веб-приложение.  
2. **Client UI:** Нажимает **"Зарегистрироваться"**.  
3. **Client UI:** Отображает форму с полями: email, username, пароль, подтверждение пароля.  
4. **User:** Заполняет форму и отправляет.  
5. **Client UI:** Отправляет `POST /api/auth/register`.  
6. **Auth Controller → User Service:** Проверяет уникальность email и username.  
7. **User Service:** Хеширует пароль и сохраняет пользователя в **Database**.  
8. **Auth Controller:** Отправляет `201 Created` (возможно с JWT-токеном).  
9. **Client UI:** Отображает сообщение: *“Аккаунт успешно создан!”* и перенаправляет на главную страницу.  

**Конец.**

### Альтернативный поток: Ошибка регистрации
- **User Service:** Возвращает `400 Bad Request` при ошибках (email уже зарегистрирован, короткий пароль и т.д.).  
- **Client UI:** Отображает сообщения об ошибках:  
  - “Email уже используется.”  
  - “Пароли не совпадают.”  
  - “Пароль должен содержать не менее 8 символов.”

---

